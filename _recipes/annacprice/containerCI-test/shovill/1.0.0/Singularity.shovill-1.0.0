Bootstrap: docker
From: debian:buster

%labels
maintainer="pricea35@cardiff.ac.uk" 
software="shovill" 
software.version="1.0.0" 
about.summary="Assemble bacterial isolate genomes from Illumina paired-end reads using shovill" 
about.home="https://github.com/tseemann/shovill"
%post


SPAdes_version=3.14.0
SKESA_version=2.3.0
MEGAHIT_version=1.2.9
velvet_version=1.2.10
Lighter_version=1.1.2
bwa_version=0.7.17
FLASH_version=1.2.11
htslib_version=1.10
samtools_version=1.10
Mash_version=2.1.1
seqtk_version=1.3
pigz_version=2.4
Trimmomatic_version=0.36
shovill_version=1.0.0

PACKAGES="wget parallel python make g++ openjdk-11-jre pilon"

PACKAGES2="zlib1g-dev libc6-dev bc unzip libbz2-dev liblzma-dev libcurl4-openssl-dev libncurses5-dev libfindbin-libs-perl"

apt-get update \
&& apt-get install -y $PACKAGES $PACKAGES2

wget http://cab.spbu.ru/files/release${SPAdes_version}/SPAdes-${SPAdes_version}-Linux.tar.gz \
&& tar -xzf SPAdes-${SPAdes_version}-Linux.tar.gz -C /usr/local/bin \
&& wget -O /usr/local/bin/skesa https://github.com/ncbi/SKESA/releases/download/v${SKESA_version}/skesa.centos6.10 \
&& chmod +x /usr/local/bin/skesa \
&& wget https://github.com/voutcn/megahit/releases/download/v${MEGAHIT_version}/MEGAHIT-${MEGAHIT_version}-Linux-x86_64-static.tar.gz \
&& tar -xzf MEGAHIT-${MEGAHIT_version}-Linux-x86_64-static.tar.gz  -C /usr/local/bin

wget https://www.ebi.ac.uk/~zerbino/velvet/velvet_${velvet_version}.tgz \
&& tar -xzf velvet_${velvet_version}.tgz -C /usr/local/bin \
&& make -C /usr/local/bin/velvet_${velvet_version} \
&& chmod +x /usr/local/bin/velvet_${velvet_version}/velvet* \
&& wget -O Lighter-${Lighter_version}.tar.gz  https://github.com/mourisl/Lighter/archive/v${Lighter_version}.tar.gz \
&& tar -xzf Lighter-${Lighter_version}.tar.gz -C /usr/local/bin \
&& make -C /usr/local/bin/Lighter-${Lighter_version} \
&& chmod +x /usr/local/bin/Lighter-${Lighter_version}/lighter

wget -O bwa-${bwa_version}.tar.gz https://github.com/lh3/bwa/archive/v${bwa_version}.tar.gz \
&& tar -xzf bwa-${bwa_version}.tar.gz -C /usr/local/bin \
&& make -C /usr/local/bin/bwa-${bwa_version} \
&& chmod +x /usr/local/bin/bwa-${bwa_version}/bwa \
&& wget ccb.jhu.edu/software/FLASH/FLASH-${FLASH_version}-Linux-x86_64.tar.gz \
&& tar -xzf FLASH-${FLASH_version}-Linux-x86_64.tar.gz \
&& chmod +x FLASH-${FLASH_version}-Linux-x86_64/flash \
&& find FLASH-${FLASH_version}-Linux-x86_64 -type f -print0 | xargs -0 mv -t /usr/local/bin

wget -O htslib-${htslib_version}.tar.gz https://github.com/samtools/htslib/archive/${htslib_version}.tar.gz \
&& tar -xzf htslib-${htslib_version}.tar.gz \
&& wget -O samtools-${samtools_version}.tar.gz https://github.com/samtools/samtools/archive/${samtools_version}.tar.gz \
&& tar -xzf samtools-${samtools_version}.tar.gz \
&& make -C samtools-${samtools_version}  -j HTSDIR=../htslib-${htslib_version} \
&& make -C samtools-${samtools_version} -j HTSDIR=../htslib-${htslib_version} prefix=/usr/local install

wget https://github.com/marbl/Mash/releases/download/v${Mash_version}/mash-Linux64-v${Mash_version}.tar \
&& tar -xf mash-Linux64-v${Mash_version}.tar \
&& mv mash-Linux64-v${Mash_version}/mash /usr/local/bin \
&& wget -O seqtk-${seqtk_version}.tar.gz https://github.com/lh3/seqtk/archive/v${seqtk_version}.tar.gz \
&& tar -xzf seqtk-${seqtk_version}.tar.gz -C /usr/local/bin \
&& make -C /usr/local/bin/seqtk-${seqtk_version} \
&& chmod +x /usr/local/bin/seqtk-${seqtk_version}/seqtk

wget zlib.net/pigz/pigz-${pigz_version}.tar.gz \
&& tar -xzf pigz-${pigz_version}.tar.gz -C /usr/local/bin \
&& make -C /usr/local/bin/pigz-${pigz_version} \
&& chmod +x /usr/local/bin/pigz-${pigz_version}/pigz \
&& wget -O /usr/local/bin/samclip https://raw.githubusercontent.com/tseemann/samclip/master/samclip \
&& chmod +x /usr/local/bin/samclip \
&& wget http://www.usadellab.org/cms/uploads/supplementary/Trimmomatic/Trimmomatic-${Trimmomatic_version}.zip \
&& unzip Trimmomatic-${Trimmomatic_version}.zip \
&& echo "#!/bin/bash" >> trimmomatic \
&& echo 'java -jar ~/src/Trimmomatic-0.36/trimmomatic-0.36.jar $@' >> /usr/bin/trimmomatic \
&& chmod +x /usr/bin/trimmomatic

wget -O shovill-${shovill_version}.tar.gz https://github.com/tseemann/shovill/archive/v${shovill_version}.tar.gz \
&& tar -xzf shovill-${shovill_version}.tar.gz -C /usr/local/bin \
&& chmod +x /usr/local/bin/shovill-${shovill_version}/bin/shovill \
&& rm *.tar.gz *.tar *.tgz *.zip

PATH=${PATH}:/usr/local/bin/SPAdes-${SPAdes_version}-Linux/bin:/usr/local/bin/MEGAHIT-${MEGAHIT_version}-Linux-x86_64-static/bin:/usr/local/bin/velvet_${velvet_version}:/usr/local/bin/Lighter-${Lighter_version}:/usr/local/bin/bwa-${bwa_version}:/usr/local/bin/seqtk-${seqtk_version}:/usr/local/bin/pigz-${pigz_version}:/usr/local/bin/shovill-${shovill_version}/bin

%environment
export SPAdes_version=3.14.0
export SKESA_version=2.3.0
export MEGAHIT_version=1.2.9
export velvet_version=1.2.10
export Lighter_version=1.1.2
export bwa_version=0.7.17
export FLASH_version=1.2.11
export htslib_version=1.10
export samtools_version=1.10
export Mash_version=2.1.1
export seqtk_version=1.3
export pigz_version=2.4
export Trimmomatic_version=0.36
export shovill_version=1.0.0
export PACKAGES="wget parallel python make g++ openjdk-11-jre pilon"
export PACKAGES2="zlib1g-dev libc6-dev bc unzip libbz2-dev liblzma-dev libcurl4-openssl-dev libncurses5-dev libfindbin-libs-perl"
export PATH=${PATH}:/usr/local/bin/SPAdes-${SPAdes_version}-Linux/bin:/usr/local/bin/MEGAHIT-${MEGAHIT_version}-Linux-x86_64-static/bin:/usr/local/bin/velvet_${velvet_version}:/usr/local/bin/Lighter-${Lighter_version}:/usr/local/bin/bwa-${bwa_version}:/usr/local/bin/seqtk-${seqtk_version}:/usr/local/bin/pigz-${pigz_version}:/usr/local/bin/shovill-${shovill_version}/bin
%runscript
exec /bin/bash "$@"
%startscript
exec /bin/bash "$@"
