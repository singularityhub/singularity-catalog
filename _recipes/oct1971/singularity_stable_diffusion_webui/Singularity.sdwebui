BootStrap: localimage
From: repositories.sif

%labels
    Maintainer oct1971
    Version    v1.0

%files

%environment

%post
    cd /opt
    git clone https://github.com/AUTOMATIC1111/stable-diffusion-webui
    cd /opt/stable-diffusion-webui
    mv /usr/local/src/repositories ./
    git -C repositories/stable-diffusion pull
    git -C repositories/stable-diffusion checkout 69ae4b35e0a0f6ee1af8bb9a5d0016ccb27e36dc
    git -C repositories/taming-transformers pull
    git -C repositories/taming-transformers checkout 24268930bf1dce879235a7fddd0b2355b84d7ea6
    git -C repositories/k-diffusion pull
    git -C repositories/k-diffusion checkout 60e5042ca0da89c14d1dd59d73883280f8fce991
    git -C repositories/CodeFormer pull
    git -C repositories/CodeFormer checkout c5b4593074ba6214284d6acd5f1719b6c5d739af
    git -C repositories/BLIP pull
    git -C repositories/BLIP checkout 48211a1594f1321b00f14c9f7a5b4813144b2fb9
 
    git -C repositories/latent-diffusion pull

    sed -i".org" -e "s/os.rename(tmpdir, target_dir)/shutil.move(tmpdir, target_dir)/" modules/ui_extensions.py
 
    pip install -r repositories/CodeFormer/requirements.txt --prefer-binary
    pip install -r /opt/stable-diffusion-webui/requirements.txt  --prefer-binary

