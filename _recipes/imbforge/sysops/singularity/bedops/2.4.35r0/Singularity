BootStrap: docker
From: alpine:latest

%labels
  Maintainer Christian Dietrich
  BEDOPS_Version 2.4.35

%apprun bam2bed
  exec bam2bed "${@}"

%apprun bam2bed-float128
  exec bam2bed-float128 "${@}"

%apprun bam2bed-megarow
  exec bam2bed-megarow "${@}"

%apprun bam2starch
  exec bam2starch "${@}"

%apprun bam2starch-float128
  exec bam2starch-float128 "${@}"

%apprun bam2starch-megarow
  exec bam2starch-megarow "${@}"

%apprun bedextract
  exec bedextract "${@}"

%apprun bedextract-float128
  exec bedextract-float128 "${@}"

%apprun bedextract-megarow
  exec bedextract-megarow "${@}"

%apprun bedmap
  exec bedmap "${@}"

%apprun bedmap-float128
  exec bedmap-float128 "${@}"

%apprun bedmap-megarow
  exec bedmap-megarow "${@}"

%apprun bedops
  exec bedops "${@}"

%apprun bedops-float128
  exec bedops-float128 "${@}"

%apprun bedops-megarow
  exec bedops-megarow "${@}"

%apprun closest-features
  exec closest-features "${@}"

%apprun closest-features-float128
  exec closest-features-float128 "${@}"

%apprun closest-features-megarow
  exec closest-features-megarow "${@}"

%apprun convert2bed
  exec convert2bed "${@}"

%apprun convert2bed-float128
  exec convert2bed-float128 "${@}"

%apprun convert2bed-megarow
  exec convert2bed-megarow "${@}"

%apprun gff2bed
  exec gff2bed "${@}"

%apprun gff2bed-float128
  exec gff2bed-float128 "${@}"

%apprun gff2bed-megarow
  exec gff2bed-megarow "${@}"

%apprun gff2starch
  exec gff2starch "${@}"

%apprun gff2starch-float128
  exec gff2starch-float128 "${@}"

%apprun gff2starch-megarow
  exec gff2starch-megarow "${@}"

%apprun gvf2bed
  exec gvf2bed "${@}"

%apprun gvf2bed-float128
  exec gvf2bed-float128 "${@}"

%apprun gvf2bed-megarow
  exec gvf2bed-megarow "${@}"

%apprun gvf2starch
  exec gvf2starch "${@}"

%apprun gvf2starch-float128
  exec gvf2starch-float128 "${@}"

%apprun gvf2starch-megarow
  exec gvf2starch-megarow "${@}"

%apprun psl2bed
  exec psl2bed "${@}"

%apprun psl2bed-float128
  exec psl2bed-float128 "${@}"

%apprun psl2bed-megarow
  exec psl2bed-megarow "${@}"

%apprun psl2starch
  exec psl2starch "${@}"

%apprun psl2starch-float128
  exec psl2starch-float128 "${@}"

%apprun psl2starch-megarow
  exec psl2starch-megarow "${@}"

%apprun rmsk2bed
  exec rmsk2bed "${@}"

%apprun rmsk2bed-float128
  exec rmsk2bed-float128 "${@}"

%apprun rmsk2bed-megarow
  exec rmsk2bed-megarow "${@}"

%apprun rmsk2starch
  exec rmsk2starch "${@}"

%apprun rmsk2starch-float128
  exec rmsk2starch-float128 "${@}"

%apprun rmsk2starch-megarow
  exec rmsk2starch-megarow "${@}"

%apprun sam2bed
  exec sam2bed "${@}"

%apprun sam2bed-float128
  exec sam2bed-float128 "${@}"

%apprun sam2bed-megarow
  exec sam2bed-megarow "${@}"

%apprun sam2starch
  exec sam2starch "${@}"

%apprun sam2starch-float128
  exec sam2starch-float128 "${@}"

%apprun sam2starch-megarow
  exec sam2starch-megarow "${@}"

%apprun sort-bed
  exec sort-bed "${@}"

%apprun sort-bed-float128
  exec sort-bed-float128 "${@}"

%apprun sort-bed-megarow
  exec sort-bed-megarow "${@}"

%apprun starch
  exec starch "${@}"

%apprun starch-diff
  exec starch-diff "${@}"

%apprun starch-diff-float128
  exec starch-diff-float128 "${@}"

%apprun starch-diff-megarow
  exec starch-diff-megarow "${@}"

%apprun starch-float128
  exec starch-float128 "${@}"

%apprun starch-megarow
  exec starch-megarow "${@}"

%apprun starchcat
  exec starchcat "${@}"

%apprun starchcat-float128
  exec starchcat-float128 "${@}"

%apprun starchcat-megarow
  exec starchcat-megarow "${@}"

%apprun starchstrip
  exec starchstrip "${@}"

%apprun starchstrip-float128
  exec starchstrip-float128 "${@}"

%apprun starchstrip-megarow
  exec starchstrip-megarow "${@}"

%apprun unstarch
  exec unstarch "${@}"

%apprun unstarch-float128
  exec unstarch-float128 "${@}"

%apprun unstarch-megarow
  exec unstarch-megarow "${@}"

%apprun vcf2bed
  exec vcf2bed "${@}"

%apprun vcf2bed-float128
  exec vcf2bed-float128 "${@}"

%apprun vcf2bed-megarow
  exec vcf2bed-megarow "${@}"

%apprun vcf2starch
  exec vcf2starch "${@}"

%apprun vcf2starch-float128
  exec vcf2starch-float128 "${@}"

%apprun vcf2starch-megarow
  exec vcf2starch-megarow "${@}"

%apprun wig2bed
  exec wig2bed "${@}"

%apprun wig2bed-float128
  exec wig2bed-float128 "${@}"

%apprun wig2bed-megarow
  exec wig2bed-megarow "${@}"

%apprun wig2starch
  exec wig2starch "${@}"

%apprun wig2starch-float128
  exec wig2starch-float128 "${@}"

%apprun wig2starch-megarow
  exec wig2starch-megarow "${@}"  

%runscript
  exec echo "Available apps: bam2bed, bam2bed-float128, bam2bed-megarow, bam2starch, bam2starch-float128, bam2starch-megarow, bedextract, bedextract-float128, bedextract-megarow, bedmap, bedmap-float128, bedmap-megarow, bedops, bedops-float128, bedops-megarow, closest-features, closest-features-float128, closest-features-megarow, convert2bed, convert2bed-float128, convert2bed-megarow, gff2bed, gff2bed-float128, gff2bed-megarow, gff2starch, gff2starch-float128, gff2starch-megarow, gvf2bed, gvf2bed-float128, gvf2bed-megarow, gvf2starch, gvf2starch-float128, gvf2starch-megarow, psl2bed, psl2bed-float128, psl2bed-megarow, psl2starch, psl2starch-float128, psl2starch-megarow, rmsk2bed, rmsk2bed-float128, rmsk2bed-megarow, rmsk2starch, rmsk2starch-float128, rmsk2starch-megarow, sam2bed, sam2bed-float128, sam2bed-megarow, sam2starch, sam2starch-float128, sam2starch-megarow, sort-bed, sort-bed-float128, sort-bed-megarow, starch, starch-diff, starch-diff-float128, starch-diff-megarow, starch-float128, starch-megarow, starchcat, starchcat-float128, starchcat-megarow, starchstrip, starchstrip-float128, starchstrip-megarow, unstarch, unstarch-float128, unstarch-megarow, vcf2bed, vcf2bed-float128, vcf2bed-megarow, vcf2starch, vcf2starch-float128, vcf2starch-megarow, wig2bed, wig2bed-float128, wig2bed-megarow, wig2starch, wig2starch-float128, wig2starch-megarow"

%post
  # Get dependencies
  echo "http://mirror.leaseweb.com/alpine/v3.8/community" >> /etc/apk/repositories
  apk update
  apk add make gcc g++ libstdc++ libgcc zlib-dev zlib linux-headers findutils bash tcsh

  # Install BEDOPS
  cd /tmp
  wget https://github.com/bedops/bedops/archive/v2.4.35.tar.gz
  tar zxf v2.4.35.tar.gz
  cd bedops-*
  sed -i 's$sys/unistd.h$unistd.h$g' ./applications/bed/sort-bed/src/SortDetails.cpp
  sed -i '24i#include <linux/limits.h>' ./applications/bed/conversion/src/convert2bed.c
  make -j$(nproc) all
  cp -rf bin/* /usr/local/bin/

  # Clean up
  apk del make gcc g++ zlib-dev linux-headers findutils
  rm -rf /var/cache/apk/*
  rm -rf /tmp/*
